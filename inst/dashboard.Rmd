---
output: pdf_document
classoption: landscape
header-includes:
   - \usepackage{subcaption,fancyhdr,graphicx,lastpage,hyperref}
---

```{r echo = FALSE}
has.logo = TRUE
has.email = TRUE
has.website = TRUE 
analist.name = "Terraço Econômico"
analist.email = "terracoeconomico@gmail.com"
analist.site = "terracoeconomico.com.br"
```

\def\haslogo{`r as.integer(has.logo)`}
\def\hasemail{`r as.integer(has.email)`} 
\def\haswebsite{`r as.integer(has.website)`} 

\fancypagestyle{plain}{
  \fancyhf{}
  \setlength{\headheight}{45pt} 
  \fancyhead[L]{
    \includegraphics[width=\linewidth,height=40pt]{logo_fgv} }
  \fancyhead[R]{
    \small 
    Analysis by \\
    \ifnum\haslogo = 1
      \includegraphics[width=\linewidth,height=20pt]{logo_terraco} \\
    \else
      `r analist.name` 
    \fi
    \ifnum\haswebsite = 1
      \url{`r analist.site`}
    \fi
  }
  \fancyfoot[L]{
      Charts generated by the {\bf BETS R Package} on `r Sys.Date()` $\diamond$ {\bf \url{https://github.com/pedrocostaferreira/BETS}}
  }
  \fancyfoot[R]{
    \thepage\  / \pageref{LastPage} }
}
\pagestyle{plain}




```{r echo = FALSE, results = "hide"}
knitr::opts_chunk$set(warning=FALSE, message=FALSE)

resetPar <- function() {
    dev.new()
    op <- par(no.readonly = TRUE)
    dev.off()
    op
}
```


```{r echo = FALSE, results = "hide"}
library(BETS)
library(rootSolve)

par(resetPar())

png("ipca.png",width=628,height=378, pointsize = 15) 

ipca = BETSget(13522)
ipca = window(ipca, start = c(2006,1))

core = BETSget(4466)
core_acc = vector(mode = "numeric")

for(i in 12:length(core)){
  sum = 0 
  for(j in 1:11){
    sum = sum + core[i-j]
  }
  core_acc[i-11] = sum 
}

core_acc = ts(core_acc, start = c(1996,12), frequency = 12)
core = window(core_acc, start = c(2006,1))

par(font.lab = 2, cex.axis = 1.2, bty = "n", las = 1)
plot(ipca, lwd = 2.5, lty = 1, xlab = "", ylab = "", main = "National Consumer Price Index (IPCA)", col = "firebrick4", ylim = c(2,11), xlim = c(2006,2016))
mtext("Cumulative 12-Month Percentage")

par(new = TRUE)
plot(core, lwd = 2.5, lty = 2, xlab = "", ylab = "", col = "firebrick3", ylim = c(2,11), xlim = c(2006,2016))

end.x = end(ipca)[1]
start.x = start(ipca)[1]
d.x = end(ipca)[2]/12 

last.core = core[length(core)]
last.ipca = ipca[length(ipca)]

par(new = TRUE)
points(end.x + d.x, last.core, pch = 21, cex = 1.25, lwd = 2, bg = "firebrick3", col = "darkgray")
points(end.x + d.x, last.ipca, pch = 21, cex = 1.25, lwd = 2, bg = "firebrick4", col = "darkgray")

x0 = end.x - 1
x1 = end.x + d.x 
y0 = 11
y1 = last.ipca

tan = (y1 - y0)/(x1 - x0)
mod = sqrt((y1 - y0)^2 + (x1 - x0)^2)
func = function(x) (1 + tan^2)*(x - x0)^2 - (mod^2)*0.75

x1.ipca = uniroot(func, c(2014,x1))$root
y1.ipca = tan*(x1.ipca - x0) + y0

arrows(x0 = x0, x1 = x1.ipca, y0 = y0, y1 = y1.ipca, length = c(0.1, 0.1), lwd = 2)

x1 = end.x + d.x 
y0 = min(core)
y1 = last.core

tan = (y1 - y0)/(x1 - x0)
mod = sqrt((y1 - y0)^2 + (x1 - x0)^2)
func = function(x) (1 + tan^2)*(x - x0)^2 - (mod^2)*0.9

x1.core = multiroot(func, start = 2015)$root
y1.core = tan*(x1.core - x0) + y0

arrows(x0 = x0, x1 = x1.core, y0 = y0, y1 = y1.core, length = c(0.1, 0.1), lwd = 2)

text(x0 - 0.6, 11, as.character(last.ipca), cex = 1.1, font = 1)
text(x0 - 0.6, min(core), as.character(last.core), cex = 1.1, font = 1)
legend("topleft", c("Full", "Core"), lty=c(1,1), lwd=c(2.5,2.5),col=c("firebrick4", "firebrick3"), bty = "n", cex = 0.9)

abline(a = 4.5, b = 0, lty = 3, lwd = 2.5, col = "darkgray")
text(end.x - 0.2, 4.1, "Target", cex = 0.9)

dev.off()
```


```{r echo=FALSE, results = "hide"}
png("cut.png",width=628,height=378, pointsize = 15)

cut = BETSget(11777)
cut = window(cut, start = c(2005,1))

par(font.lab = 2, cex.axis = 1.2, bty = "n", las = 1)
plot(cut, lwd = 2.5, lty = 1, xlab = "", ylab = "", main = "Unitary Labor Cost", col = "firebrick4", ylim = c(70,180), xlim = c(2006,2016))
mtext("US$ - June 1994 = 100")

end.x = end(cut)[1]
d.x = end(cut)[2]/12 
last = cut[length(cut)]

points(end.x + d.x, last, pch = 21, cex = 1.25, lwd = 2, bg = "firebrick4", col = "darkgray")

x1 = end.x + d.x 
y0 = 135
y1 = last + 5

arrows(x0 = x1, x1 = x1, y0 = y0, y1 = y1, length = c(0.1, 0.1), lwd = 2)
text(x1 - 0.3, y0 + 6, as.character(last), cex = 1.1, font = 1)

dev.off()
```

\begin{figure}[h]
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1\linewidth]{ipca}
  \label{ipca}
\end{subfigure}
~
\begin{subfigure}{.5\textwidth}
  \centering
  \includegraphics[width=1\linewidth]{cut}
  \label{cut}
\end{subfigure}
\end{figure}


```{r, echo = FALSE, results='asis'}
text <- paste(readLines("text.txt"), collapse=" ")
text = gsub(pattern = "\\\\n", replacement = "  \n", x = text)
text <- strsplit(text, "##")[[1]]
cat(text[1])
```

\newpage

```{r}
emptyplot(main = "Arrowhead")
arrows2D(x0 = runif(10), y0 = runif(10),
         x1 = runif(10), y1 = runif(10), colvar = 1:10, 
         code = 1)
```

